<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Service - Flair</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root {
      --primary: #6366f1;
      --primary-soft: #eef2ff;
      --bg: #f8fafc;
      --text: #0f172a;
      --text-muted: #64748b;
      --card-border: #e2e8f0;
      --success-bg: #ecfdf3;
      --success-text: #15803d;
      --danger-bg: #fef2f2;
      --danger-text: #b91c1c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      padding-bottom: 90px;
    }

    .navbar {
      background: white;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e2e8f0;
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      background: #f8fafc;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .logo {
      font-weight: 800;
      font-size: 1.1rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo i {
      background: linear-gradient(135deg, #6366f1, #a855f7);
      color: white;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }

    .hero {
      padding: 12px 16px 10px;
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      color: white;
    }

    .hero-inner {
      max-width: 900px;
      margin: 0 auto;
    }

    .hero-top {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .salon-image-slider {
      width: 100%;
      overflow-x: auto;
      display: flex;
      gap: 10px;
      scroll-snap-type: x mandatory;
      scrollbar-width: thin;
    }

    .salon-image-slider::-webkit-scrollbar {
      height: 4px;
    }

    .salon-image-slider::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.8);
      border-radius: 999px;
    }

    .salon-img-slide {
      flex: 0 0 70%;
      max-width: 70%;
      height: 160px;
      border-radius: 18px;
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
      scroll-snap-align: start;
    }

    .salon-img-slide-overlay {
      position: absolute;
      inset: auto 10px 10px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.72rem;
      color: #e5e7eb;
    }

    .salon-img-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      backdrop-filter: blur(6px);
    }

    .hero-bottom {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .hero-left {
      flex: 1.3;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .salon-name {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .salon-location {
      font-size: 0.82rem;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
      opacity: 0.95;
    }

    .salon-location i {
      font-size: 0.8rem;
    }

    .salon-tags {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.7rem;
    }

    .salon-tag {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(226, 232, 240, 0.45);
      background: rgba(15, 23, 42, 0.25);
    }

    .hero-right {
      flex: 0.9;
      min-width: 210px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .rating-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.4);
      font-size: 0.8rem;
    }

    .rating-chip i {
      color: #facc15;
    }

    .status-chip {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-open {
      background: var(--success-bg);
      color: var(--success-text);
    }

    .status-closed {
      background: var(--danger-bg);
      color: var(--danger-text);
    }

    .hours-text {
      font-size: 0.78rem;
      color: #e5e7eb;
      opacity: 0.9;
    }

    .directions-btn {
      margin-top: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(226, 232, 240, 0.5);
      background: rgba(15, 23, 42, 0.2);
      color: #e5e7eb;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .container {
      max-width: 900px;
      margin: 8px auto 0;
      padding: 0 16px 12px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .section-header h2 {
      font-size: 0.98rem;
    }

    .section-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .category-scroll {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 6px 0 10px;
      scrollbar-width: thin;
    }

    .category-scroll::-webkit-scrollbar {
      height: 4px;
    }

    .category-scroll::-webkit-scrollbar-thumb {
      background: #cbd5f5;
      border-radius: 999px;
    }

    .category-chip {
      background: white;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      border: 1px solid #e2e8f0;
      color: var(--text-muted);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s ease-out;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .category-chip.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      box-shadow: 0 8px 18px rgba(99, 102, 241, 0.35);
    }

    .services-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-bottom: 12px;
    }

    .service-card {
      background: white;
      border-radius: 16px;
      padding: 12px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid var(--card-border);
      cursor: pointer;
      transition: all 0.16s ease-out;
    }

    .service-card:hover {
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
      transform: translateY(-1px);
    }

    .service-card.selected {
      border-color: var(--primary);
      background: var(--primary-soft);
      box-shadow: 0 10px 26px rgba(99, 102, 241, 0.16);
    }

    .service-img {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: #eef2ff;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .service-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0;
    }

    .service-name {
      font-weight: 600;
      font-size: 0.92rem;
    }

    .service-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .meta-pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
    }

    .service-price {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
      font-size: 0.86rem;
    }

    .price-value {
      font-weight: 700;
      color: var(--primary);
      font-size: 0.95rem;
    }

    .price-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .service-check {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 2px solid #cbd5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: white;
      background: white;
      transition: all 0.16s ease-out;
    }

    .service-card.selected .service-check {
      background: var(--primary);
      border-color: var(--primary);
    }

    .service-card.selected .service-check i {
      display: block;
    }

    .service-check i {
      display: none;
    }

    .professionals-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding-bottom: 16px;
    }

    .pro-card {
      background: white;
      border-radius: 14px;
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid #e2e8f0;
    }

    .pro-avatar {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--primary);
    }

    .pro-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.78rem;
    }

    .pro-name {
      font-weight: 600;
      font-size: 0.86rem;
    }

    .pro-role {
      color: var(--text-muted);
    }

    .pro-tag {
      font-size: 0.72rem;
      color: var(--primary);
    }

    .footer-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 10px 18px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      z-index: 30;
    }

    .footer-summary {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.82rem;
    }

    .footer-total-label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .footer-total-value {
      font-size: 1rem;
      font-weight: 700;
    }

    .footer-selected-count {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .btn-next {
      background: var(--primary);
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-weight: 700;
      text-decoration: none;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 26px rgba(99, 102, 241, 0.35);
      transition: all 0.16s ease-out;
    }

    .btn-next:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .btn-next:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(79, 70, 229, 0.5);
    }

    @media (max-width: 640px) {
      .hero-top {
        gap: 10px;
      }
      .salon-img-slide {
        flex-basis: 85%;
        max-width: 85%;
        height: 150px;
      }
      .hero-bottom {
        flex-direction: column;
        align-items: flex-start;
      }
      .hero-right {
        align-items: flex-start;
      }
      .footer-bar {
        padding: 10px 14px;
      }
      .btn-next {
        padding-inline: 18px;
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="navbar-left">
      <button class="back-btn" id="backBtn">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="logo">
        <i class="fas fa-sparkles"></i>
        <span>Flair</span>
      </div>
    </div>
    <div style="width: 28px;"></div>
  </header>

  <section class="hero">
    <div class="hero-inner">
      <div class="hero-top">
        <div class="salon-image-slider" id="salonImageSlider"></div>
        <div class="hero-bottom">
          <div class="hero-left">
            <div class="salon-name" id="salonName">Salon name</div>
            <div class="salon-location">
              <i class="fas fa-location-dot"></i>
              <span id="salonAddress">Address</span>
            </div>
            <div class="salon-tags" id="salonTags"></div>
          </div>
          <div class="hero-right">
            <div class="rating-chip" id="ratingChip" style="display:none;">
              <i class="fas fa-star"></i>
              <span id="ratingValue">4.8</span>
              <span id="ratingCount">• 120 reviews</span>
            </div>
            <div class="status-chip" id="statusChip">
              <i class="fas fa-circle"></i>
              <span id="statusText">Checking hours...</span>
            </div>
            <div class="hours-text" id="hoursText">Today: –</div>
            <button class="directions-btn" id="directionsBtn">
              <i class="fas fa-route"></i>
              <span>Get directions</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="container">
    <div class="section-header" style="margin-top:10px;">
      <div>
        <h2>Select services</h2>
        <p class="section-sub">Tap to select or deselect, you can choose multiple.</p>
      </div>
    </div>

    <div class="category-scroll" id="categoryScroll"></div>
    <div class="services-list" id="servicesList"></div>

    <div class="section-header" style="margin-top:4px;">
      <div>
        <h2>Our professionals</h2>
        <p class="section-sub">You can pick a specific stylist on the next step.</p>
      </div>
    </div>
    <div class="professionals-list" id="professionalsList"></div>
  </main>

  <footer class="footer-bar">
    <div class="footer-summary">
      <span class="footer-total-label">Total</span>
      <span class="footer-total-value" id="totalAmount">₹0</span>
      <span class="footer-selected-count" id="selectedCount">No services selected</span>
    </div>
    <button class="btn-next" id="nextButton" disabled>
      Next
      <i class="fas fa-arrow-right"></i>
    </button>
  </footer>

  <script type="module" src="firebase-init.js"></script>
  <script type="module">
    import {
      collection,
      doc,
      getDoc,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    const { db } = window.flairFirebase || {};

    const params = new URLSearchParams(window.location.search);
    const salonId = params.get("salonId") || "";

    const backBtn = document.getElementById("backBtn");
    const salonNameEl = document.getElementById("salonName");
    const salonAddressEl = document.getElementById("salonAddress");
    const salonTagsEl = document.getElementById("salonTags");
    const salonImageSlider = document.getElementById("salonImageSlider");
    const ratingChip = document.getElementById("ratingChip");
    const ratingValueEl = document.getElementById("ratingValue");
    const ratingCountEl = document.getElementById("ratingCount");
    const statusChip = document.getElementById("statusChip");
    const statusTextEl = document.getElementById("statusText");
    const hoursTextEl = document.getElementById("hoursText");
    const directionsBtn = document.getElementById("directionsBtn");

    const categoryScroll = document.getElementById("categoryScroll");
    const servicesListEl = document.getElementById("servicesList");
    const professionalsListEl = document.getElementById("professionalsList");

    const totalAmountEl = document.getElementById("totalAmount");
    const selectedCountEl = document.getElementById("selectedCount");
    const nextButton = document.getElementById("nextButton");

    let ownerId = null;
    let salonLocation = null;
    let openingHours = null; // from salon.hours

    const selectedServiceIds = new Set();
    const allServices = [];
    let currentCategory = "all";

    backBtn.addEventListener("click", () => {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = "customer-home.html";
      }
    });

    function formatCurrency(amount) {
      return "₹" + Math.round(amount || 0).toLocaleString("en-IN");
    }

    function recalcTotal() {
      let total = 0;
      let count = 0;
      allServices.forEach(svc => {
        if (selectedServiceIds.has(svc.id)) {
          total += svc.price || 0;
          count++;
        }
      });

      totalAmountEl.textContent = formatCurrency(total);
      if (count === 0) {
        selectedCountEl.textContent = "No services selected";
        nextButton.disabled = true;
      } else if (count === 1) {
        selectedCountEl.textContent = "1 service selected";
        nextButton.disabled = false;
      } else {
        selectedCountEl.textContent = count + " services selected";
        nextButton.disabled = false;
      }
    }

    function createServiceCard(service) {
      const card = document.createElement("div");
      card.className = "service-card";
      card.dataset.id = service.id;
      card.dataset.category = service.category || "other";
      card.dataset.price = service.price || 0;

      const iconClass =
        (service.category === "hair" && "fa-cut") ||
        (service.category === "nails" && "fa-hand-sparkles") ||
        (service.category === "skin" && "fa-face-smile-beam") ||
        (service.category === "spa" && "fa-spa") ||
        "fa-scissors";

      card.innerHTML = `
        <div class="service-img">
          <i class="fas ${iconClass}"></i>
        </div>
        <div class="service-info">
          <div class="service-name">${service.name || "Service"}</div>
          <div class="service-meta">
            <span class="meta-pill">${service.durationMinutes || 0} min</span>
            ${service.level ? `<span class="meta-pill">${service.level}</span>` : ""}
          </div>
        </div>
        <div class="service-price">
          <span class="price-value">${formatCurrency(service.price || 0)}</span>
          <span class="price-sub">${service.shortNote || ""}</span>
        </div>
        <div class="service-check">
          <i class="fas fa-check"></i>
        </div>
      `;

      card.addEventListener("click", () => {
        const id = service.id;
        if (selectedServiceIds.has(id)) {
          selectedServiceIds.delete(id);
          card.classList.remove("selected");
        } else {
          selectedServiceIds.add(id);
          card.classList.add("selected");
        }
        recalcTotal();
      });

      return card;
    }

    function renderCategoryChips() {
      const categories = new Set(["all"]);
      allServices.forEach(svc => {
        if (svc.category) categories.add(svc.category);
      });

      categoryScroll.innerHTML = "";
      categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.className = "category-chip" + (cat === "all" ? " active" : "");
        btn.dataset.category = cat;
        btn.textContent = cat === "all"
          ? "All"
          : cat.charAt(0).toUpperCase() + cat.slice(1);

        btn.addEventListener("click", () => {
          currentCategory = cat;
          document.querySelectorAll(".category-chip").forEach(c => c.classList.remove("active"));
          btn.classList.add("active");
          filterServices();
        });

        categoryScroll.appendChild(btn);
      });
    }

    function filterServices() {
      const cards = servicesListEl.querySelectorAll(".service-card");
      cards.forEach(card => {
        const cat = card.dataset.category || "other";
        if (currentCategory === "all" || cat === currentCategory) {
          card.style.display = "flex";
        } else {
          card.style.display = "none";
        }
      });
    }

    function createProfessionalCard(staff) {
      const card = document.createElement("div");
      card.className = "pro-card";

      const initials = (staff.name || "S")
        .split(" ")
        .map(p => p[0])
        .join("")
        .slice(0, 2)
        .toUpperCase();

      card.innerHTML = `
        <div class="pro-avatar">${initials}</div>
        <div class="pro-info">
          <div class="pro-name">${staff.name || "Professional"}</div>
          <div class="pro-role">${staff.role || staff.specialty || ""}</div>
          ${staff.specialty ? `<div class="pro-tag">${staff.specialty}</div>` : ""}
        </div>
      `;

      return card;
    }

    function computeOpenStatus() {
      if (!openingHours) {
        statusChip.classList.remove("status-open", "status-closed");
        statusChip.classList.add("status-closed");
        statusTextEl.textContent = "Hours not set";
        hoursTextEl.textContent = "Today: –";
        return;
      }

      const now = new Date();
      const weekdayIndex = now.getDay(); // 0 = Sun
      const keys = ["sun","mon","tue","wed","thu","fri","sat"];
      const key = keys[weekdayIndex];
      const today = openingHours[key];

      if (!today || !today.open || !today.close) {
        statusChip.classList.remove("status-open");
        statusChip.classList.add("status-closed");
        statusTextEl.textContent = "Closed";
        hoursTextEl.textContent = "Today: Closed";
        return;
      }

      const [oh, om] = (today.open || "10:00").split(":").map(Number);
      const [ch, cm] = (today.close || "20:00").split(":").map(Number);

      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      const openMinutes = oh * 60 + om;
      const closeMinutes = ch * 60 + cm;

      const isOpen = currentMinutes >= openMinutes && currentMinutes < closeMinutes;

      statusChip.classList.remove("status-open", "status-closed");
      if (isOpen) {
        statusChip.classList.add("status-open");
        statusTextEl.textContent = "Open now";
      } else {
        statusChip.classList.add("status-closed");
        statusTextEl.textContent = "Closed now";
      }

      function formatHM(h, m) {
        let hh = h;
        const ampm = hh >= 12 ? "PM" : "AM";
        hh = hh % 12;
        if (hh === 0) hh = 12;
        const mm = m.toString().padStart(2, "0");
        return `${hh.toString().padStart(2,"0")}:${mm} ${ampm}`;
      }

      const openLabel = formatHM(oh, om);
      const closeLabel = formatHM(ch, cm);
      hoursTextEl.textContent = `Today: ${openLabel} – ${closeLabel}`;
    }

    directionsBtn.addEventListener("click", () => {
      if (salonLocation && typeof salonLocation.latitude === "number" && typeof salonLocation.longitude === "number") {
        const url = `https://www.google.com/maps/dir/?api=1&destination=${salonLocation.latitude},${salonLocation.longitude}`;
        window.open(url, "_blank");
      } else if (salonLocation && typeof salonLocation.lat === "number" && typeof salonLocation.lng === "number") {
        // In case GeoPoint was serialized differently
        const url = `https://www.google.com/maps/dir/?api=1&destination=${salonLocation.lat},${salonLocation.lng}`;
        window.open(url, "_blank");
      } else {
        const name = salonNameEl.textContent || "";
        const addr = salonAddressEl.textContent || "";
        const url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(name + " " + addr)}`;
        window.open(url, "_blank";
      }
    });

    nextButton.addEventListener("click", () => {
      if (!selectedServiceIds.size || !salonId) return;
      const firstServiceId = Array.from(selectedServiceIds)[0];

      const q = new URLSearchParams();
      q.set("salonId", salonId);
      q.set("serviceId", firstServiceId);
      window.location.href = "select-slot.html?" + q.toString();
    });

    async function loadPage() {
      if (!db) {
        alert("Firebase not initialized. Please check firebase-init.js.");
        return;
      }
      if (!salonId) {
        alert("Missing salon. Please go back and pick a salon again.");
        return;
      }

      const salonRef = doc(db, "salons", salonId);
      const salonSnap = await getDoc(salonRef);
      if (!salonSnap.exists()) {
        alert("Salon not found.");
        return;
      }
      const salon = salonSnap.data() || {};
      ownerId = salon.ownerId || salon.ownerUid || null;
      salonNameEl.textContent = salon.businessName || "Salon";

      // Address line: use address or city/state
      const address = salon.address || "";
      const city = salon.city || "";
      const state = salon.state || "";
      const addrPieces = [address, city, state].filter(Boolean);
      salonAddressEl.textContent = addrPieces.join(", ") || "Address not available";

      salonLocation = salon.location || null;
      openingHours = salon.hours || null;  // NOTE: using your 'hours' map

      // Rating
      if (typeof salon.rating === "number" && salon.rating > 0) {
        ratingChip.style.display = "inline-flex";
        ratingValueEl.textContent = salon.rating.toFixed(1);
        const count = salon.ratingCount || 0;
        ratingCountEl.textContent = count ? `• ${count} reviews` : "";
      } else {
        ratingChip.style.display = "none";
      }

      // Tags (optional)
      salonTagsEl.innerHTML = "";
      if (salon.tags && Array.isArray(salon.tags)) {
        salon.tags.forEach(t => {
          const span = document.createElement("span");
          span.className = "salon-tag";
          span.textContent = t;
          salonTagsEl.appendChild(span);
        });
      }

      // Images slider using imageUrls
      salonImageSlider.innerHTML = "";
      const photos = Array.isArray(salon.imageUrls) && salon.imageUrls.length
        ? salon.imageUrls
        : [
            "https://images.pexels.com/photos/3738341/pexels-photo-3738341.jpeg?auto=compress&cs=tinysrgb&w=800",
            "https://images.pexels.com/photos/3738345/pexels-photo-3738345.jpeg?auto=compress&cs=tinysrgb&w=800",
            "https://images.pexels.com/photos/3735630/pexels-photo-3735630.jpeg?auto=compress&cs=tinysrgb&w=800",
          ];

      photos.forEach((url, idx) => {
        const slide = document.createElement("div");
        slide.className = "salon-img-slide";
        slide.style.backgroundImage = `url("${url}")`;
        slide.innerHTML = `
          <div class="salon-img-slide-overlay">
            <span class="salon-img-pill">
              <i class="fas fa-camera"></i>
              <span>${idx + 1} / ${photos.length}</span>
            </span>
          </div>
        `;
        salonImageSlider.appendChild(slide);
      });

      computeOpenStatus();

      if (!ownerId) {
        console.warn("No ownerId on salon; cannot load services.");
        return;
      }

      // Services
      const servicesCol = collection(db, "owners", ownerId, "ownerServices");
      const servicesSnap = await getDocs(servicesCol);
      allServices.length = 0;
      servicesListEl.innerHTML = "";

      servicesSnap.forEach(docSnap => {
        const data = docSnap.data() || {};
        const svc = {
          id: docSnap.id,
          name: data.name || "Service",
          category: (data.category || "other").toLowerCase(),
          price: Number(data.price || 0),
          durationMinutes: Number(data.durationMinutes || 0),
          level: data.level || data.tier || "",
          shortNote: data.shortNote || "",
        };
        allServices.push(svc);
      });

      if (!allServices.length) {
        servicesListEl.innerHTML = "<p style='font-size:0.85rem; color:#6b7280;'>No services added for this salon yet.</p>";
      } else {
        allServices.forEach(svc => {
          servicesListEl.appendChild(createServiceCard(svc));
        });
      }

      renderCategoryChips();
      filterServices();
      recalcTotal();

      // Professionals
      const staffCol = collection(db, "owners", ownerId, "ownerStaff");
      const staffSnap = await getDocs(staffCol);
      professionalsListEl.innerHTML = "";
      if (staffSnap.empty) {
        professionalsListEl.innerHTML = "<p style='font-size:0.85rem; color:#6b7280;'>Salon has not added professionals yet.</p>";
      } else {
        staffSnap.forEach(docSnap => {
          const data = docSnap.data() || {};
          const st = {
            id: docSnap.id,
            name: data.name || data.displayName || "Professional",
            role: data.role || "",
            specialty: data.specialty || "",
          };
          professionalsListEl.appendChild(createProfessionalCard(st));
        });
      }
    }

    loadPage().catch(e => {
      console.error("Error loading booking page:", e);
      alert("Could not load salon details. Please try again.");
    });
  </script>
</body>
</html>
